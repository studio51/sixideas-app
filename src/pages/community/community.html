<ion-header>
  <ion-navbar>
    <ion-title>Community</ion-title>
  </ion-navbar>

  <ion-segment [(ngModel)]="feed" color="primary" ngClass="-colour-{{ user?.colour }}">
    <ion-segment-button value="community">
      <!-- <ion-icon name="paper"></ion-icon> -->
      News Feed
    </ion-segment-button>

    <ion-segment-button value="trending">
      <!-- <ion-icon name="list"></ion-icon> -->
      Trending
    </ion-segment-button>

    <ion-segment-button value="likes">
      <!-- <ion-icon name="heart"></ion-icon> -->
      Likes
    </ion-segment-button>

    <ion-segment-button value="hashtag">
      <ion-icon name="grid"></ion-icon>
    </ion-segment-button>
  </ion-segment>
</ion-header>

<ion-content>
  <post *ngFor="let post of posts" [post]="post" [user]="post?.user"></post>

  <ng-container [ngSwitch]="feed">
    <ng-container *ngSwitchCase="'community'">
      
      <ion-card *ngIf="currentUser">
        <ion-card-header>
          <ion-grid no-padding>
            <ion-row align-items-center>
              <ion-col col-2>
                <user-avatar [user]="currentUser"></user-avatar>
              </ion-col>

              <ion-col margin-left>
                <h2 no-margin>{{ currentUser.name }}</h2>
              </ion-col>
            </ion-row>
          </ion-grid>
        </ion-card-header>

        <ion-card-content padding text-center (tap)="showNewPostForm()" [ngStyle]="{ 'background-color': postForm.controls.colour.value }">
          <h2 no-margin *ngUnless="newPostFormIsActive">What's new?</h2>
          <!-- <ion-spinner *ngIf="newPostFormIsActive"></ion-spinner> -->

          <form *ngIf="newPostFormIsActive" [formGroup]="postForm">
            <ion-item #postFormTitle clear>
              <ion-label>Title (optional)</ion-label>
              <ion-input type="text" formControlName="title"></ion-input>
            </ion-item>

            <ion-item>
              <ion-textarea formControlName="body" placeholder="What's new?"></ion-textarea>
            </ion-item>

            <ion-grid no-padding>
              <ion-row align-items-center>
                <ion-col>
                  <button ion-button small square *ngFor="let colour of postColours" [ngClass]="postForm.controls.colour.value === colour.hex ? 'selected' : ''" [ngStyle]="{ 'background-color': colour.hex === null ? 'transparent' : colour.hex }" (tap)="changePostFormColour(colour.hex)"></button>
                </ion-col>

                <ion-col col-auto>
                  <button ion-button color="primary" small [disabled]="!postForm.valid" (click)="addPost()">
                    Create Post
                  </button>
                </ion-col>

                <ion-col #postFormImageOptions col-auto>
                  <button ion-button color="primary" outline small icon-only (click)="showPostFormImageOptions()">
                    <ion-icon name="camera"></ion-icon>
                  </button>
                </ion-col>
              </ion-row>
            </ion-grid>
          </form>
        </ion-card-content>
      </ion-card>
    
    </ng-container>
  </ng-container>

</ion-content>
